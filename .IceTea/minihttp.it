var minihttp_dir = pfs.join(__DIR__, "../deps/minihttp");

target("minihttp", "lib") {
    title: "miniHTTP",
    input: [pfs.join(
        minihttp_dir,
        "minihttp.cpp"
    )],
    needs: [],
    init: function() {
        cli.group "minihttp: Tiny HTTP(S) client with mbedTLS support"
        cli.insert {
            longopt: "--no-ssl",
            desc: "Build minihttp without SSL support (will use included mbedTLS otherwise)"
        };
        cli.insert {
            longopt: "--minihttp-debug",
            desc: "Build minihttp with debug symbols"
        };
    },
    configure: function() {
        if(!cli.check("--no-ssl")) {
            @needs[] = "mbedtls";
            @settings.CXX.defines[] = "MINIHTTP_USE_MBEDTLS";
        }

        if(sys.type == "windows") {
            @settings.LINK.libraries[] = "ws2_32";
        }

        // Export everything.
        @exports = @exports + @settings;

        // Non-export stuff
        @settings.CXX.shouldDebug = (DEBUG || cli.check("--minihttp-debug"));

        return true;
    },
    exports: {},
    settings: {
        CXX: {
            includeDirs: [minihttp_dir],
            defines: []
        },
        LINK: {
            libraries: []
        }
    }
}
